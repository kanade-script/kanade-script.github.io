<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Video Chat</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --dark: #2d3436;
            --light: #f5f6fa;
            --danger: #ff7675;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            overflow: hidden;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }
        
        .video-container {
            display: flex;
            flex: 1;
            position: relative;
        }
        
        .remote-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }
        
        .local-video {
            position: absolute;
            bottom: 100px;
            right: 20px;
            width: 200px;
            height: 150px;
            border-radius: 10px;
            border: 3px solid var(--primary);
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        
        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem;
            display: flex;
            justify-content: center;
            gap: 2rem;
            z-index: 100;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
        }
        
        .next-btn {
            background: var(--primary);
        }
        
        .report-btn {
            background: var(--danger);
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            z-index: 10;
        }
        
        .connection-status {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00b894;
        }
        
        .disconnected {
            background: #ff7675;
        }
        
        .connecting {
            background: #fdcb6e;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="loading-screen" id="loadingScreen">
            <div class="loader"></div>
            <p id="loadingText">–ò—â–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...</p>
        </div>
        
        <div class="video-container">
            <video class="remote-video" id="remoteVideo" autoplay playsinline></video>
            <video class="local-video" id="localVideo" autoplay playsinline muted></video>
            
            <div class="user-info">
                <span id="userCountry">üåç –°–æ–±–µ—Å–µ–¥–Ω–∏–∫: –æ–∂–∏–¥–∞–Ω–∏–µ...</span>
            </div>
            
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...</span>
            </div>
        </div>
        
        <div class="controls">
            <button class="control-btn report-btn" title="–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è" id="reportBtn">üö©</button>
            <button class="control-btn" title="–û—Ç–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω" id="muteBtn">üé§</button>
            <button class="control-btn next-btn" title="–°–ª–µ–¥—É—é—â–∏–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫" id="nextBtn">‚è≠Ô∏è</button>
            <button class="control-btn" title="–û—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É" id="videoBtn">üì∑</button>
            <button class="control-btn" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–∑–æ–≤" id="endCallBtn">üìû</button>
        </div>
    </div>
    
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PeerJS
        const peerConfig = {
            host: '0.peerjs.com',
            port: 443,
            secure: true,
            path: '/',
            debug: 3
        };
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const loadingScreen = document.getElementById('loadingScreen');
        const loadingText = document.getElementById('loadingText');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const userCountry = document.getElementById('userCountry');
        const muteBtn = document.getElementById('muteBtn');
        const videoBtn = document.getElementById('videoBtn');
        const nextBtn = document.getElementById('nextBtn');
        const endCallBtn = document.getElementById('endCallBtn');
        const reportBtn = document.getElementById('reportBtn');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let localStream;
        let peer;
        let currentCall;
        let isMuted = false;
        let isVideoOff = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function init() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                localVideo.srcObject = localStream;
                
                // –°–æ–∑–¥–∞–µ–º Peer —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                peer = new Peer(generateRandomId(), peerConfig);
                
                peer.on('open', (id) => {
                    console.log('My peer ID is: ' + id);
                    updateStatus('connected', '–ì–æ—Ç–æ–≤ –∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é');
                    loadingText.textContent = '–ò—â–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...';
                    findPartner();
                });
                
                peer.on('call', (call) => {
                    updateStatus('connecting', '–í—Ö–æ–¥—è—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...');
                    loadingScreen.style.display = 'none';
                    
                    call.answer(localStream);
                    currentCall = call;
                    
                    call.on('stream', (remoteStream) => {
                        remoteVideo.srcObject = remoteStream;
                        updateStatus('connected', '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                        userCountry.textContent = `üåç –°–æ–±–µ—Å–µ–¥–Ω–∏–∫: ${getRandomCountry()}`;
                    });
                    
                    call.on('close', () => {
                        endCall();
                    });
                    
                    call.on('error', (err) => {
                        console.error('Call error:', err);
                        endCall();
                    });
                });
                
                peer.on('error', (err) => {
                    console.error('Peer error:', err);
                    updateStatus('disconnected', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                    setTimeout(init, 3000);
                });
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫
                muteBtn.addEventListener('click', toggleMute);
                videoBtn.addEventListener('click', toggleVideo);
                nextBtn.addEventListener('click', findPartner);
                endCallBtn.addEventListener('click', endCall);
                reportBtn.addEventListener('click', reportUser);
                
            } catch (err) {
                console.error('Failed to get local stream', err);
                loadingText.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ/–º–∏–∫—Ä–æ—Ñ–æ–Ω—É';
                updateStatus('disconnected', '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º');
            }
        }
        
        // –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
        function findPartner() {
            if (currentCall) {
                currentCall.close();
            }
            
            loadingScreen.style.display = 'flex';
            loadingText.textContent = '–ò—â–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...';
            updateStatus('connecting', '–ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...');
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –∂–¥–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è
            setTimeout(() => {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º—ã –±—ã –ø–æ–ª—É—á–∏–ª–∏ ID –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                const randomPeerId = generateRandomId();
                connectToPeer(randomPeerId);
            }, Math.random() * 3000 + 1000);
        }
        
        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        function connectToPeer(peerId) {
            if (!peer || !localStream) return;
            
            updateStatus('connecting', '–°–æ–µ–¥–∏–Ω—è–µ–º—Å—è...');
            loadingText.textContent = '–°–æ–µ–¥–∏–Ω—è–µ–º—Å—è...';
            
            const call = peer.call(peerId, localStream);
            currentCall = call;
            
            call.on('stream', (remoteStream) => {
                remoteVideo.srcObject = remoteStream;
                loadingScreen.style.display = 'none';
                updateStatus('connected', '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                userCountry.textContent = `üåç –°–æ–±–µ—Å–µ–¥–Ω–∏–∫: ${getRandomCountry()}`;
            });
            
            call.on('close', () => {
                endCall();
            });
            
            call.on('error', (err) => {
                console.error('Call error:', err);
                endCall();
            });
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞
        function endCall() {
            if (currentCall) {
                currentCall.close();
                currentCall = null;
            }
            
            if (remoteVideo.srcObject) {
                remoteVideo.srcObject.getTracks().forEach(track => track.stop());
                remoteVideo.srcObject = null;
            }
            
            loadingScreen.style.display = 'flex';
            loadingText.textContent = '–ò—â–µ–º –Ω–æ–≤–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...';
            updateStatus('connected', '–ì–æ—Ç–æ–≤ –∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é');
            userCountry.textContent = 'üåç –°–æ–±–µ—Å–µ–¥–Ω–∏–∫: –æ–∂–∏–¥–∞–Ω–∏–µ...';
            
            setTimeout(findPartner, 1000);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        function toggleMute() {
            if (!localStream) return;
            
            const audioTracks = localStream.getAudioTracks();
            if (audioTracks.length > 0) {
                isMuted = !isMuted;
                audioTracks[0].enabled = !isMuted;
                muteBtn.textContent = isMuted ? 'üîá' : 'üé§';
                muteBtn.style.backgroundColor = isMuted ? 'var(--danger)' : 'rgba(255, 255, 255, 0.1)';
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ
        function toggleVideo() {
            if (!localStream) return;
            
            const videoTracks = localStream.getVideoTracks();
            if (videoTracks.length > 0) {
                isVideoOff = !isVideoOff;
                videoTracks[0].enabled = !isVideoOff;
                videoBtn.textContent = isVideoOff ? 'üìπ' : 'üì∑';
                videoBtn.style.backgroundColor = isVideoOff ? 'var(--danger)' : 'rgba(255, 255, 255, 0.1)';
                localVideo.style.display = isVideoOff ? 'none' : 'block';
            }
        }
        
        // –ñ–∞–ª–æ–±–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function reportUser() {
            alert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å –≤ —É–ª—É—á—à–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞!');
            endCall();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function updateStatus(status, text) {
            statusText.textContent = text;
            
            statusDot.className = 'status-dot';
            if (status === 'connected') {
                statusDot.classList.add('connected');
            } else if (status === 'connecting') {
                statusDot.classList.add('connecting');
            } else {
                statusDot.classList.add('disconnected');
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function generateRandomId() {
            return 'user-' + Math.random().toString(36).substr(2, 9);
        }
        
        function getRandomCountry() {
            const countries = ['–†–æ—Å—Å–∏—è', '–°–®–ê', '–ì–µ—Ä–º–∞–Ω–∏—è', '–§—Ä–∞–Ω—Ü–∏—è', '–Ø–ø–æ–Ω–∏—è', '–ë—Ä–∞–∑–∏–ª–∏—è', '–ö–∏—Ç–∞–π', '–ò–Ω–¥–∏—è', '–ò—Ç–∞–ª–∏—è', '–ò—Å–ø–∞–Ω–∏—è'];
            return countries[Math.floor(Math.random() * countries.length)];
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>
